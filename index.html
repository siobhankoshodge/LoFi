<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Manifestation Meadow</title>
    
    <link rel="icon" type="image/x-icon" href="favicon.ico">

    <style>
        :root {
            --sky-top: #87ceeb;
            --sky-bottom: #e0f6ff;
            --accent: #4a7a8c;
        }

        body, html {
            margin: 0; padding: 0; width: 100%; height: 100%;
            overflow: hidden; font-family: 'Segoe UI', sans-serif;
            background: linear-gradient(to bottom, var(--sky-top), var(--sky-bottom));
        }

        #setup-overlay {
            position: fixed; inset: 0; 
            background: linear-gradient(to bottom, var(--sky-top), var(--sky-bottom));
            z-index: 9999; display: flex; flex-direction: column; 
            align-items: center; justify-content: center;
            padding: 20px; text-align: center;
        }

        .instructions {
            max-width: 450px; margin-bottom: 20px; line-height: 1.5;
            color: var(--accent); font-style: italic; font-size: 1.1rem;
        }

        #word-selector { 
            display: flex !important; flex-wrap: wrap !important; 
            justify-content: center !important; gap: 10px; 
            max-width: 600px; margin: 20px auto;
            min-height: 150px; width: 100%;
        }

        .choice-pill {
            padding: 12px 20px; border: 2px solid white; border-radius: 25px;
            cursor: pointer; color: #333; background: rgba(255,255,255,0.6);
            font-weight: bold; transition: 0.2s;
        }

        .choice-pill.selected { background: var(--accent); color: white; border-color: var(--accent); }

        #ui-layer { position: fixed; top: 10px; width: 100%; text-align: center; color: var(--accent); z-index: 100; display: none; }
        #controls { position: fixed; bottom: 20px; left: 20px; z-index: 101; display: none; }
        
        #start-btn {
            padding: 15px 40px; border-radius: 35px; border: none;
            background: #4a7a8c; color: white; font-weight: bold;
            cursor: pointer; opacity: 0.3; pointer-events: none;
        }
        #start-btn.active { opacity: 1; pointer-events: auto; }

        .garden { position: absolute; inset: 0; pointer-events: none; z-index: 1; }
        .grass { position: absolute; bottom: 0; width: 100%; height: 45px; background: #5ea300; z-index: 10; border-top: 4px solid #74b816;}
        .seed { position: absolute; padding: 10px 18px; background: white; border-radius: 30px; font-weight: bold; box-shadow: 0 4px 10px rgba(0,0,0,0.1); cursor: pointer; }
        .plant { position: absolute; bottom: 45px; display: flex; flex-direction: column-reverse; align-items: center; }
        .stem { width: 6px; background: #74b816; transition: height 2s; }
        .flower-head { width: 20px; height: 20px; background: #ffec99; border-radius: 50%; position: relative; }
        .petal { position: absolute; width: 40px; height: 20px; border-radius: 50%; left: 50%; top: 50%; margin-top: -10px; transform-origin: left center; transition: 4s; }
    </style>
</head>
<body>

    <div id="setup-overlay">
        <h1 style="color: var(--accent); margin-bottom: 10px;">Manifestation Meadow</h1>
        <div class="instructions">Choose your manifestation, take a moment, and be mindful in the meadow with your words.</div>
        
        <div id="word-selector"></div>
        
        <button id="start-btn" onclick="startGame()">Enter the Meadow</button>
    </div>

    <div id="ui-layer">
        <h2 id="counter">0 / 50 Intentions</h2>
    </div>

    <div id="controls">
        <button onclick="toggleSound()" style="padding:10px; border-radius:20px; border:none; background:white; font-weight:bold; color:#4a7a8c;">
            Sound: <span id="snd-st">OFF</span>
        </button>
    </div>

    <div id="garden" class="garden"></div>
    <div id="seed-container" style="position:absolute; inset:0; pointer-events:auto; z-index:20;"></div>
    <div class="grass"></div>

    <script>
        (function() {
            const words = ["Peace", "Clarity", "Growth", "Love", "Abundance", "Kindness", "Focus", "Joy", "Health", "Balance", "Courage", "Trust", "Patience", "Wisdom", "Strength", "Grace"];
            let selected = [];
            let count = 0;
            let audioCtx, isMuted = true;
            let tuneInterval;

            function initGrid() {
                const grid = document.getElementById('word-selector');
                if (!grid) { setTimeout(initGrid, 100); return; }
                
                grid.innerHTML = '';
                words.forEach(w => {
                    const p = document.createElement('div');
                    p.className = 'choice-pill';
                    p.textContent = w;
                    p.onclick = () => {
                        if (p.classList.contains('selected')) {
                            p.classList.remove('selected');
                            selected = selected.filter(x => x !== w);
                        } else if (selected.length < 10) {
                            p.classList.add('selected');
                            selected.push(w);
                        }
                        document.getElementById('start-btn').className = selected.length >= 2 ? 'active' : '';
                    };
                    grid.appendChild(p);
                });
            }
            initGrid();

            window.startGame = function() {
                document.getElementById('setup-overlay').style.display = 'none';
                document.getElementById('ui-layer').style.display = 'block';
                document.getElementById('controls').style.display = 'block';
                initAudio();
                setInterval(spawn, 1800);
            };

            function initAudio() {
                if (audioCtx) return;
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            }

            // --- SUMMER TUNE LOGIC ---
            function playSummerNote() {
                if (isMuted || !audioCtx) return;
                const pentatonic = [523.25, 587.33, 659.25, 783.99, 880.00, 1046.50];
                const freq = pentatonic[Math.floor(Math.random() * pentatonic.length)];
                
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                
                osc.type = 'sine';
                osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
                
                gain.gain.setValueAtTime(0, audioCtx.currentTime);
                gain.gain.linearRampToValueAtTime(0.03, audioCtx.currentTime + 1); // Soft fade in
                gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 4); // Long tail
                
                osc.connect(gain);
                gain.connect(audioCtx.destination);
                
                osc.start();
                osc.stop(audioCtx.currentTime + 4);
            }

            window.toggleSound = async function() {
                if (!audioCtx) initAudio();
                if (audioCtx.state === 'suspended') await audioCtx.resume();
                isMuted = !isMuted;
                document.getElementById('snd-st').textContent = isMuted ? "OFF" : "ON";
                
                if (!isMuted) {
                    // Start the summer background tune
                    tuneInterval = setInterval(playSummerNote, 2500);
                } else {
                    clearInterval(tuneInterval);
                }
            };

            function playChime() {
                if (isMuted || !audioCtx) return;
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.frequency.setValueAtTime(1200 + Math.random() * 200, audioCtx.currentTime);
                gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.5);
                osc.connect(gain); gain.connect(audioCtx.destination);
                osc.start(); osc.stop(audioCtx.currentTime + 0.5);
            }

            function spawn() {
                if (count >= 50) return;
                const s = document.createElement('div');
                s.className = 'seed';
                s.textContent = selected[Math.floor(Math.random()*selected.length)];
                s.style.left = (Math.random()*80 + 10) + '%';
                s.style.top = '-50px';
                document.getElementById('seed-container').appendChild(s);

                const collect = () => {
                    playChime();
                    createFlower(parseFloat(s.style.left), s.textContent);
                    s.remove(); count++;
                    document.getElementById('counter').textContent = count + " / 50 Intentions";
                    if (count >= 50) release();
                };
                s.onmousedown = collect;
                s.ontouchstart = (e) => { e.preventDefault(); collect(); };

                let y = -50;
                const t = setInterval(() => {
                    y += 2; s.style.top = y + 'px';
                    if (y > window.innerHeight || count >= 50) { clearInterval(t); if(s.parentNode) s.remove(); }
                }, 16);
            }

            function createFlower(x, txt) {
                const p = document.createElement('div');
                p.className = 'plant'; p.style.left = x + '%';
                const h = document.createElement('div');
                h.className = 'flower-head';
                const color = ['#ffb6c1','#add8e6','#dda0dd','#ffdab9'][Math.floor(Math.random()*4)];
                for(let i=0; i<6; i++) {
                    const pt = document.createElement('div');
                    pt.className = 'petal';
                    pt.style.background = color;
                    pt.style.transform = `rotate(${i*60}deg)`;
                    h.appendChild(pt);
                }
                const st = document.createElement('div'); st.className = 'stem'; st.style.height = '0px';
                p.appendChild(st); p.appendChild(h);
                document.getElementById('garden').appendChild(p);
                setTimeout(() => st.style.height = (Math.random()*100 + 100) + 'px', 50);
            }

            function release() {
                document.querySelectorAll('.petal').forEach(p => {
                    p.style.transform += ` translate(${(Math.random()-0.5)*1000}px, -100vh) rotate(720deg)`;
                    p.style.opacity = '0';
                });
                setTimeout(() => {
                    document.querySelectorAll('.plant').forEach(pl => pl.style.opacity = '0');
                }, 1000);
                setTimeout(() => location.reload(), 6000);
            }
        })();
    </script>
</body>
</html>

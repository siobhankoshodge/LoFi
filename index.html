<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manifestation Meadow - Fixed</title>
    <style>
        :root {
            --sky-top: #87ceeb;
            --sky-bottom: #e0f6ff;
            --stem-color: #7d8f69;
            --text-color: #4a5568;
        }

        body, html {
            margin: 0; padding: 0;
            width: 100vw; height: 100vh;
            background: linear-gradient(to bottom, var(--sky-top), var(--sky-bottom)) no-repeat;
            background-attachment: fixed;
            overflow: hidden;
            font-family: 'Courier New', Courier, monospace;
        }

        /* This layer captures clicks to spawn words manually */
        #interaction-layer {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 1; cursor: crosshair;
        }

        #garden { position: relative; width: 100%; height: 100%; z-index: 10; pointer-events: none; }

        .seed-word {
            position: absolute; padding: 12px 24px;
            background: #ffffff; border: 2px solid #a29bfe; border-radius: 30px;
            color: var(--text-color); cursor: pointer; font-size: 15px; font-weight: bold;
            box-shadow: 0 4px 15px rgba(162, 155, 254, 0.4); 
            z-index: 9999; /* Set to be above EVERYTHING */
            pointer-events: auto;
            white-space: nowrap;
            user-select: none;
        }

        .plant {
            position: absolute; bottom: 0; width: 120px;
            transform-origin: bottom center;
            transition: transform 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 20;
        }

        .sway-wrapper {
            display: flex; flex-direction: column; align-items: center;
            animation: windSway 4s ease-in-out infinite alternate;
        }

        @keyframes windSway { 
            from { transform: rotate(-2deg); } 
            to { transform: rotate(2deg); } 
        }

        .flower-canvas { 
            margin-bottom: -55px; /* Fuses head to stem core */
            z-index: 22; 
            transform: scale(0); 
            transition: transform 1.2s ease-out; 
        }
        .flower-canvas.bloomed { transform: scale(1); }

        .stem { 
            width: 4px; 
            background: linear-gradient(to top, #3e4a34, var(--stem-color)); 
            border-radius: 4px; 
            height: 0px; 
            z-index: 21; 
            transition: height 0.6s ease-out;
        }

        .label {
            background: rgba(255, 255, 255, 0.95); 
            padding: 4px 12px; 
            border-radius: 12px;
            font-size: 11px; 
            box-shadow: 0 2px 8px rgba(0,0,0,0.1); 
            z-index: 30; /* Front and center */
            border: 1px solid rgba(0,0,0,0.05);
            margin-top: 5px;
            white-space: nowrap;
        }

        #grass-container { position: absolute; bottom: 0; left: 0; width: 100%; height: 100%; z-index: 5; pointer-events: none; }
        .blade { position: absolute; bottom: 0; width: 2px; background: #94a684; border-radius: 2px 2px 0 0; }
    </style>
</head>
<body>

    <div id="interaction-layer"></div>
    <div id="garden">
        <div id="grass-container"></div>
    </div>

    <script>
        const interactionLayer = document.getElementById('interaction-layer');
        const garden = document.getElementById('garden');
        const grassContainer = document.getElementById('grass-container');
        
        const colorMap = {
            "Growth": "#ffb7c5", "Peace": "#b2e2f2", "Abundance": "#f9e076",
            "Healing": "#b4f8c8", "Clarity": "#ffffff", "Love": "#ff6b6b", "Focus": "#a29bfe"
        };
        const manifestationWords = Object.keys(colorMap);
        const plants = [];
        let audioCtx;

        function startAudio() {
            if (audioCtx) return;
            audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = 'sine'; osc.frequency.setValueAtTime(110, audioCtx.currentTime);
            gain.gain.setValueAtTime(0, audioCtx.currentTime);
            gain.gain.linearRampToValueAtTime(0.02, audioCtx.currentTime + 2);
            osc.connect(gain); gain.connect(audioCtx.destination);
            osc.start();
        }

        function spawnWord() {
            const word = manifestationWords[Math.floor(Math.random() * manifestationWords.length)];
            const el = document.createElement('div');
            el.className = 'seed-word';
            el.innerText = word;
            // Ensure they spawn within visible area
            el.style.left = (15 + Math.random() * 70) + '%';
            el.style.top = '-60px';
            document.body.appendChild(el);

            let pos = -60;
            const float = setInterval(() => {
                pos += 1.2;
                el.style.top = pos + 'px';
                if (pos > window.innerHeight) { clearInterval(float); el.remove(); }
            }, 16);

            el.onclick = (e) => {
                e.stopPropagation();
                startAudio();
                const rect = el.getBoundingClientRect();
                createPlant(rect.left + rect.width / 2, el.innerText);
                growGrass();
                clearInterval(float);
                el.remove();
            };
        }

        function growGrass() {
            for(let i=0; i<10; i++) {
                const blade = document.createElement('div');
                blade.className = 'blade';
                blade.style.left = Math.random() * 100 + '%';
                blade.style.height = (Math.random() * 30 + 10) + 'px';
                grassContainer.appendChild(blade);
            }
        }

        function createPlant(x, text) {
            const plantObj = { height: 10, maxHeight: 150 + Math.random() * 300, element: document.createElement('div'), canvas: document.createElement('canvas'), stemElement: null };
            plantObj.element.className = 'plant';
            plantObj.element.style.left = (x - 60) + 'px';
            
            const wrapper = document.createElement('div');
            wrapper.className = 'sway-wrapper';

            plantObj.canvas.width = plantObj.canvas.height = 120;
            plantObj.canvas.className = 'flower-canvas';
            
            const stem = document.createElement('div');
            stem.className = 'stem';
            
            const label = document.createElement('div');
            label.className = 'label';
            label.innerText = text;

            wrapper.appendChild(plantObj.canvas);
            wrapper.appendChild(stem);
            wrapper.appendChild(label);
            plantObj.element.appendChild(wrapper);
            garden.appendChild(plantObj.element);

            const ctx = plantObj.canvas.getContext('2d');
            const color = colorMap[text] || "#fff";
            ctx.translate(60, 60);
            
            // Petals
            ctx.fillStyle = color;
            for (let i = 0; i < 8; i++) {
                ctx.rotate((Math.PI * 2) / 8);
                ctx.beginPath(); ctx.moveTo(0, 0);
                ctx.bezierCurveTo(28, -28, 28, 28, 0, 0); ctx.fill();
            }

            // Central Core (Pistil) - This was missing in your screenshot
            ctx.beginPath();
            ctx.arc(0, 0, 8, 0, Math.PI * 2);
            ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';
            ctx.fill();

            setTimeout(() => plantObj.canvas.classList.add('bloomed'), 100);
            plantObj.stemElement = stem;
            plants.push(plantObj);
        }

        // Auto-spawn loop
        setInterval(() => {
            if(document.querySelectorAll('.seed-word').length < 3) spawnWord();
        }, 3000);
        
        // Manual trigger: Click sky to spawn a word
        interactionLayer.onclick = () => { startAudio(); spawnWord(); };

        // Subtle Mouse Interaction
        document.addEventListener('mousemove', (e) => {
            plants.forEach(p => {
                const rect = p.canvas.getBoundingClientRect();
                const dx = e.clientX - (rect.left + 60);
                const dy = e.clientY - (rect.top + 60);
                const dist = Math.sqrt(dx*dx + dy*dy);

                if (dist < 80) {
                    const power = (1 - (dist / 80)) * 6; 
                    p.element.style.transform = `rotate(${dx > 0 ? -power : power}deg)`;
                } else {
                    p.element.style.transform = `rotate(0deg)`;
                }
            });
        });

        // Growth loop
        setInterval(() => {
            plants.forEach(p => {
                if (p.height < p.maxHeight) {
                    p.height += 12;
                    p.stemElement.style.height = p.height + 'px';
                }
            });
        }, 100);
    </script>
</body>
</html>

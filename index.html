<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Proximity Manifestation Garden</title>
    <style>
        :root {
            --bg-color: #f7f9fa;
            --stem-color: #7d8f69;
            --text-color: #4a5568;
        }

        body, html {
            margin: 0; padding: 0;
            width: 100vw; height: 100vh;
            background-color: var(--bg-color);
            overflow: hidden;
            font-family: 'Courier New', Courier, monospace;
        }

        #garden { width: 100%; height: 100%; position: relative; }

        .seed-word {
            position: absolute;
            padding: 10px 20px;
            background: white;
            border: 1px solid #d1d9e0;
            border-radius: 30px;
            color: var(--text-color);
            cursor: pointer;
            font-size: 13px;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            z-index: 100;
        }

        .plant {
            position: absolute;
            bottom: 0;
            transform-origin: bottom center;
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: transform 0.2s cubic-bezier(0.2, 0.8, 0.2, 1);
        }

        .stem { 
            width: 4px; 
            background: linear-gradient(to top, #3e4a34, var(--stem-color)); 
            border-radius: 4px; 
            height: 0px; 
            transition: height 0.6s ease-out; 
        }

        .flower-canvas { transform: scale(0); transition: transform 1.5s ease-out; }
        .flower-canvas.bloomed { transform: scale(1); }

        .label {
            margin-top: 8px; font-size: 10px; color: var(--text-color);
            background: rgba(255,255,255,0.8); padding: 2px 8px; border-radius: 10px;
        }

        .overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; background: url('https://grainy-gradients.vercel.app/noise.svg');
            opacity: 0.08; z-index: 10;
        }
    </style>
</head>
<body>

    <div class="overlay"></div>
    <div id="garden"></div>

    <script>
        const garden = document.getElementById('garden');
        
        const colorMap = {
            "Growth": "#ffb7c5",
            "Peace": "#b2e2f2",
            "Abundance": "#f9e076",
            "Healing": "#b4f8c8",
            "Clarity": "#ffffff",
            "Love": "#ff6b6b",
            "Focus": "#a29bfe"
        };

        const manifestationWords = Object.keys(colorMap);
        const plants = [];
        let audioCtx;

        // --- RELIABLE AUDIO: Built-in Synth ---
        function startBreathingAudio() {
            if (audioCtx) return;
            audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            
            osc.type = 'sine';
            osc.frequency.setValueAtTime(110, audioCtx.currentTime); // Low A drone
            
            gain.gain.setValueAtTime(0, audioCtx.currentTime);
            gain.gain.linearRampToValueAtTime(0.05, audioCtx.currentTime + 2);
            
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start();

            // LFO for "breathing" effect
            const lfo = audioCtx.createOscillator();
            const lfoGain = audioCtx.createGain();
            lfo.frequency.value = 0.2; // Slow breathing
            lfoGain.gain.value = 0.02;
            lfo.connect(lfoGain);
            lfoGain.connect(gain.gain);
            lfo.start();
        }

        document.body.addEventListener('click', startBreathingAudio);

        // --- SPAWNING LOGIC ---
        function spawnWord() {
            const word = manifestationWords[Math.floor(Math.random() * manifestationWords.length)];
            const el = document.createElement('div');
            el.className = 'seed-word';
            el.innerText = word;
            el.style.left = Math.random() * (window.innerWidth - 150) + 'px';
            el.style.top = '-60px';
            garden.appendChild(el);

            let pos = -60;
            const float = setInterval(() => {
                pos += 0.7;
                el.style.top = pos + 'px';
                if (pos > window.innerHeight) { clearInterval(float); el.remove(); }
            }, 20);

            el.addEventListener('click', (e) => {
                e.stopPropagation();
                createPlant(parseInt(el.style.left) + 60, el.innerText);
                el.remove();
            });
        }

        setInterval(spawnWord, 4000);

        function createPlant(x, text) {
            const plantObj = {
                x: x,
                height: 10,
                maxHeight: 250 + Math.random() * 250,
                element: document.createElement('div'),
                stemElement: null
            };

            plantObj.element.className = 'plant';
            plantObj.element.style.left = x + 'px';

            const canvas = document.createElement('canvas');
            canvas.width = canvas.height = 100;
            canvas.className = 'flower-canvas';
            
            const stem = document.createElement('div');
            stem.className = 'stem';

            const label = document.createElement('div');
            label.className = 'label';
            label.innerText = text;

            plantObj.element.appendChild(canvas);
            plantObj.element.appendChild(stem);
            plantObj.element.appendChild(label);
            garden.appendChild(plantObj.element);

            drawFlower(canvas.getContext('2d'), colorMap[text]);
            setTimeout(() => canvas.classList.add('bloomed'), 100);
            
            plantObj.stemElement = stem;
            plants.push(plantObj);
        }

        function drawFlower(ctx, color) {
            const petals = 8;
            ctx.translate(50, 50);
            ctx.fillStyle = color;
            for (let i = 0; i < petals; i++) {
                ctx.rotate((Math.PI * 2) / petals);
                ctx.beginPath();
                ctx.moveTo(0, 0);
                ctx.bezierCurveTo(25, -25, 25, 25, 0, 0);
                ctx.fill();
            }
            ctx.beginPath(); ctx.arc(0, 0, 5, 0, Math.PI * 2);
            ctx.fillStyle = 'rgba(0,0,0,0.1)'; ctx.fill();
        }

        // --- PROXIMITY REACTION (1cm approx 38px) ---
        document.addEventListener('mousemove', (e) => {
            const proximityLimit = 50; // Roughly 1-2cm depending on screen density

            plants.forEach(p => {
                const rect = p.element.getBoundingClientRect();
                const plantMidX = rect.left + rect.width / 2;
                const plantMidY = rect.bottom - (p.height / 2);
                
                const dist = Math.sqrt(Math.pow(e.clientX - plantMidX, 2) + Math.pow(e.clientY - plantMidY, 2));

                if (dist < proximityLimit) {
                    const leanDirection = (e.clientX < plantMidX) ? 10 : -10;
                    p.element.style.transform = `rotate(${leanDirection}deg) scale(1.05)`;
                } else {
                    p.element.style.transform = `rotate(0deg) scale(1)`;
                }
            });
        });

        // --- GROWTH ENGINE ---
        setInterval(() => {
            plants.forEach(p => {
                if (p.height < p.maxHeight) {
                    p.height += 10;
                    p.stemElement.style.height = p.height + 'px';
                }
            });
        }, 100);

    </script>
</body>
</html>
